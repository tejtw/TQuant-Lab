# å½¼å¾—â€§æ—å€é¸è‚¡å“²å­¸å¯¦è¸ï¼šæˆé•·èˆ‡åƒ¹å€¼å…¼å…·çš„é‡åŒ–ç­–ç•¥

- [å½¼å¾—â€§æ—å€é¸è‚¡å“²å­¸å¯¦è¸ï¼šæˆé•·èˆ‡åƒ¹å€¼å…¼å…·çš„é‡åŒ–ç­–ç•¥](#å½¼å¾—æ—å€é¸è‚¡å“²å­¸å¯¦è¸æˆé•·èˆ‡åƒ¹å€¼å…¼å…·çš„é‡åŒ–ç­–ç•¥)
  - [å‰è¨€](#å‰è¨€)
  - [æŠ•è³‡æ¨™çš„ ï¼† å›æ¸¬æœŸé–“](#æŠ•è³‡æ¨™çš„--å›æ¸¬æœŸé–“)
  - [ç­–ç•¥é‚è¼¯](#ç­–ç•¥é‚è¼¯)
  - [è‚¡ç¥¨ç¯©é¸ç¨‹å¼ç¢¼å±•ç¤º](#è‚¡ç¥¨ç¯©é¸ç¨‹å¼ç¢¼å±•ç¤º)
    - [å°å…¥å¥—ä»¶](#å°å…¥å¥—ä»¶)
  - [åŒ¯å…¥è‚¡ç¥¨æ± ï¼ˆæ‰€æœ‰æ›¾ç¶“ä¸Šä¸‹å¸‚æ«ƒçš„æ™®é€šè‚¡ï¼‰](#åŒ¯å…¥è‚¡ç¥¨æ± æ‰€æœ‰æ›¾ç¶“ä¸Šä¸‹å¸‚æ«ƒçš„æ™®é€šè‚¡)
  - [åŒ¯å…¥è‚¡ç¥¨è²¡å‹™è³‡è¨Š](#åŒ¯å…¥è‚¡ç¥¨è²¡å‹™è³‡è¨Š)
  - [è™•ç†è³‡æ–™](#è™•ç†è³‡æ–™)
  - [åŒ¯å…¥å›æ¸¬è³‡æ–™](#åŒ¯å…¥å›æ¸¬è³‡æ–™)
  - [å›æ¸¬æ¶æ§‹](#å›æ¸¬æ¶æ§‹)
  - [ç¸¾æ•ˆåœ–è¡¨ï¼†åˆ†æ](#ç¸¾æ•ˆåœ–è¡¨åˆ†æ)
  - [ç¸¾æ•ˆåœ–è¡¨ï¼†åˆ†æ](#ç¸¾æ•ˆåœ–è¡¨åˆ†æ-1)

---

## å‰è¨€

å½¼å¾—â€§æ—å€ï¼ˆPeter Lynchï¼‰æ˜¯ç¾åœ‹åŸºé‡‘ç•Œå‚³å¥‡äººç‰©ï¼Œæ›¾æ–¼ 1977 è‡³ 1990 å¹´é–“æ“”ä»» **å¯Œé”éº¥å“²å€«åŸºé‡‘ï¼ˆFidelity Magellan Fundï¼‰** ç¶“ç†äººã€‚  
å…¶é–“åŸºé‡‘è³‡ç”¢è¦æ¨¡å¾ 2,000 è¬ç¾å…ƒæˆé•·è‡³ 140 å„„ç¾å…ƒï¼Œå¹´åŒ–å ±é…¬ç‡é«˜é” **29.2%**ï¼Œå ªç¨±å²ä¸Šæœ€æˆåŠŸçš„åŸºé‡‘ç¶“ç†ä¹‹ä¸€ã€‚  

ä»–ä¸åƒ…ä»¥ç¸¾æ•ˆèåï¼Œæ›´ä»¥æ·±å…¥æ·ºå‡ºçš„æŠ•è³‡å“²å­¸å•Ÿç™¼ç„¡æ•¸æ•£æˆ¶èˆ‡å°ˆæ¥­æŠ•è³‡äººã€‚  
æ—å€å€¡å°ã€Œ**æŠ•è³‡ä½ æ‰€ç†Ÿæ‚‰çš„ä¼æ¥­**ã€ï¼ˆInvest in what you knowï¼‰ï¼Œèªç‚ºå€‹äººæŠ•è³‡è€…æ“æœ‰è§€å¯Ÿç”Ÿæ´»çš„å„ªå‹¢ï¼Œèƒ½åœ¨ä¼æ¥­åŸºæœ¬é¢åæ˜ æ–¼è‚¡åƒ¹å‰ç‡å…ˆç™¼ç¾æ½›åŠ›è‚¡ã€‚  

å…¶æŠ•è³‡å“²å­¸å¼·èª¿ï¼š  
- é¸è‚¡æ‡‰å»ºç«‹åœ¨ **ä¼æ¥­ç²åˆ©èƒ½åŠ›ã€æˆé•·æ€§èˆ‡è²¡å‹™ç©©å¥**  
- ä½¿ç”¨ **æœ¬ç›Šæ¯” (P/E)ã€ç›ˆé¤˜æˆé•·ç‡ (EPS Growth)** ç­‰æŒ‡æ¨™  
- ç™¼æ˜ã€Œ**è¢«ä½ä¼°çš„æˆé•·è‚¡**ã€  

---

## æŠ•è³‡æ¨™çš„ ï¼† å›æ¸¬æœŸé–“

- **æŠ•è³‡æ¨™çš„**ï¼šå°ç£è­‰äº¤æ‰€èˆ‡æ«ƒè²·ä¸­å¿ƒæ‰€æœ‰ä¸Šå¸‚æ«ƒå…¬å¸  
- **è³‡æ–™ç¯„åœ**ï¼š2017 å¹´èµ·è‚¡åƒ¹ã€è²¡å ±ã€è‘£ç›£äº‹æŒè‚¡ç­‰åŸºç¤è³‡æ–™  
- **å›æ¸¬æœŸé–“**ï¼š2018-01-01 è‡³ 2025-04-29  
- **ç†ç”±**ï¼šç­–ç•¥é‚è¼¯éœ€å¼•ç”¨æœ€è¿‘ä¸€å¹´è²¡å‹™è³‡è¨Šï¼Œå› æ­¤å°‡å›æ¸¬æœŸèµ·é»è¨­åœ¨ 2018 å¹´ï¼Œä»¥ç¢ºä¿è³‡æ–™å®Œæ•´æ€§ã€‚  

---

## ç­–ç•¥é‚è¼¯

å½¼å¾—ï¼æ—å€çš„æŠ•è³‡å“²å­¸ï¼š  
- å¼·èª¿ **æˆé•· + åƒ¹å€¼å…¼å…·** çš„ä¼æ¥­  
- ä¸ä¾è³´å¸‚å ´æ™‚æ©Ÿæˆ–ç¸½é«”ç¶“æ¿Ÿé æ¸¬  
- æ³¨é‡ **å…¬å¸æœ¬èº«èˆ‡è²¡å‹™é«”è³ª**  

æœ¬æ–‡å°‡æ—å€çš„æ ¸å¿ƒè²¡å‹™æ¨™æº–è½‰åŒ–ç‚º **äº”é …é‡åŒ–æ¢ä»¶**ï¼š  

1. **æœ€è¿‘ä¸€å­£è² å‚µæ¯”ç‡ â‰¤ 25%**  
   - éé«˜çš„æ§“æ¡¿æœƒå¢åŠ å„Ÿå‚µå£“åŠ›  
   - æ§åˆ¶åœ¨ 25% ä»¥ä¸‹ç¢ºä¿è²¡å‹™é«”è³ªè‰¯å¥½  

2. **æ¯è‚¡æ·¨ç¾é‡‘ > ç”¢æ¥­å¹³å‡å€¼**  
   - åæ˜ çŸ­æœŸæµå‹•æ€§èˆ‡è³‡æœ¬çµæ§‹å½ˆæ€§  
   - è¦æ±‚é«˜æ–¼åŒç”¢æ¥­å¹³å‡ï¼Œé¡¯ç¤ºç¾é‡‘å„ªå‹¢  

3. **P/FCF < ç”¢æ¥­å¹³å‡å€¼**  
   - P/FCF = è‚¡åƒ¹ Ã· æ¯è‚¡è‡ªç”±ç¾é‡‘æµ  
   - ä»£è¡¨ç¾é‡‘å‰µé€ åŠ›å¼·ä¸”ä¼°å€¼åˆç†  

4. **å­˜è²¨æˆé•·ç‡ < ç‡Ÿæ”¶æˆé•·ç‡**  
   - é¿å…å­˜è²¨ç´¯ç© > éŠ·å”®æˆé•·  
   - ç¯©é¸ç”¢éŠ·å”èª¿è‰¯å¥½çš„ä¼æ¥­  

5. **(1å¹´å¹³å‡ç›ˆé¤˜æˆé•·ç‡ + ç¾é‡‘è‚¡æ¯ç‡) Ã· P/E â‰¥ 2**  
   - ç¢ºä¿ã€Œé«˜æˆé•· + ç©©å®šé…æ¯ + åˆç†ä¼°å€¼ã€  

---

ğŸ‘‰ åœ¨å¯¦å‹™æ“ä½œä¸Šï¼š  
- é€šéä¸Šè¿°æ¢ä»¶çš„è‚¡ç¥¨ â†’ **ç­‰æ¬Šé‡è²·å…¥**  
- **æŒæœ‰è‡³ä¸‹ä¸€æ¬¡å†å¹³è¡¡æ—¥**ï¼ˆæ¯ 30 å¤©æ›è‚¡ä¸€æ¬¡ï¼‰  

## è‚¡ç¥¨ç¯©é¸ç¨‹å¼ç¢¼å±•ç¤º

### å°å…¥å¥—ä»¶

```python
import pandas as pd
import numpy as np
import tejapi
import os
import datetime

start = '2017-01-01'
end   = '2025-04-29'

os.environ['TEJAPI_KEY'] = 'Your Key'
```
## åŒ¯å…¥è‚¡ç¥¨æ± ï¼ˆæ‰€æœ‰æ›¾ç¶“ä¸Šä¸‹å¸‚æ«ƒçš„æ™®é€šè‚¡ï¼‰
```python
from logbook import Logger, StderrHandler, INFO

log_handler = StderrHandler(
    format_string='[{record.time:%Y-%m-%d %H:%M:%S.%f}]: {record.level_name}: {record.func_name}: {record.message}',
    level=INFO
)
log_handler.push_application()
log = Logger('get_universe')

from zipline.sources.TEJ_Api_Data import get_universe

# ç”±æ–‡å­—å‹æ…‹è½‰ç‚º Timestampï¼Œä¾›å›æ¸¬ä½¿ç”¨
tz = 'UTC'
start_dt, end_dt = pd.Timestamp(start, tz=tz), pd.Timestamp(end, tz=tz)

# å–å¾—æ­·å²å…¨é«”æ™®é€šè‚¡ï¼ˆå«æ›¾ä¸Šä¸‹å¸‚æ«ƒï¼‰
pool = get_universe(start=start_dt,
                    end=end_dt,
                    mkt=['TWSE', 'OTC'],
                    stktp_e=['Common Stock-Foreign', 'Common Stock'])
```
## åŒ¯å…¥è‚¡ç¥¨è²¡å‹™è³‡è¨Š
```python
import TejToolAPI

columns = [
    'ä¸»ç”¢æ¥­åˆ¥_ä¸­æ–‡', 'å ±é…¬ç‡', 'æ”¶ç›¤åƒ¹', 'æœ¬ç›Šæ¯”', 'ç¾é‡‘åŠç´„ç•¶ç¾é‡‘',
    'éæµå‹•è² å‚µåˆè¨ˆ', 'è² å‚µæ¯”ç‡', 'ç‡Ÿæ”¶æˆé•·ç‡', 'ç¾é‡‘è‚¡åˆ©ç‡', 'ç¨…å¾Œæ·¨åˆ©æˆé•·ç‡',
    'å­˜è²¨', 'ç‡Ÿé‹ç”¢ç”Ÿç¾é‡‘æµé‡', 'æŠ•è³‡ç”¢ç”Ÿç¾é‡‘æµé‡', 'å€‹è‚¡å¸‚å€¼_å…ƒ', 'åŠ æ¬Šå¹³å‡è‚¡æ•¸'
]

data__ = TejToolAPI.get_history_data(start=start_dt,
                                     end=end_dt,
                                     ticker=pool,
                                     fin_type=['Q'],   # ä½¿ç”¨å­£è³‡æ–™
                                     columns=columns,
                                     transfer_to_chinese=True)
```
## è™•ç†è³‡æ–™
```python 
# ä»¥å­˜è²¨è®Šå‹•ç‚ºåŸºç¤è¨ˆç®—å­˜è²¨æˆé•·ç‡ï¼ˆå°‡è®Šå‹•æ—¥å¾€å¾ŒçŒå…¥ï¼‰
inv_change_df = data__.copy()
inv_change_df['å­˜è²¨è®Šå‹•'] = inv_change_df.groupby('è‚¡ç¥¨ä»£ç¢¼')['å­˜è²¨_Q'].diff().ne(0)
inv_change_df = inv_change_df.loc[inv_change_df['å­˜è²¨è®Šå‹•'], ['è‚¡ç¥¨ä»£ç¢¼', 'æ—¥æœŸ', 'å­˜è²¨_Q']]

inv_change_df['å­˜è²¨æˆé•·ç‡'] = inv_change_df.groupby('è‚¡ç¥¨ä»£ç¢¼')['å­˜è²¨_Q'].pct_change()
inv_change_df.loc[inv_change_df['å­˜è²¨æˆé•·ç‡'] == 0, 'å­˜è²¨æˆé•·ç‡'] = np.nan

# æŠŠè®Šå‹•æ—¥å°é½Šåˆ°æ—¥è³‡æ–™ä¸­ï¼Œä¸¦å‘å¾Œå¡«å…¥
idx = pd.MultiIndex.from_frame(data__.loc[:, ['è‚¡ç¥¨ä»£ç¢¼', 'æ—¥æœŸ']])
inv_growth_series = (
    inv_change_df
    .set_index(['è‚¡ç¥¨ä»£ç¢¼', 'æ—¥æœŸ'])['å­˜è²¨æˆé•·ç‡']
    .reindex(idx)
    .groupby(level=0)
    .ffill()
)

data__['å­˜è²¨æˆé•·ç‡'] = inv_growth_series.values

# å–®ä½èª¿æ•´èˆ‡è¡ç”ŸæŒ‡æ¨™
data__['å€‹è‚¡å¸‚å€¼(åƒ)'] = data__['å€‹è‚¡å¸‚å€¼_å…ƒ'] / 1000
data__['æ¯è‚¡æ·¨ç¾é‡‘'] = (data__['ç¾é‡‘åŠç´„ç•¶ç¾é‡‘_Q'] - data__['éæµå‹•è² å‚µåˆè¨ˆ_Q']) / data__['åŠ æ¬Šå¹³å‡è‚¡æ•¸_Q'] * 1000
data__['æ¯è‚¡è‡ªç”±ç¾é‡‘æµ'] = (data__['ç‡Ÿé‹ç”¢ç”Ÿç¾é‡‘æµé‡_Q'] - data__['æŠ•è³‡ç”¢ç”Ÿç¾é‡‘æµé‡_Q']) / data__['åŠ æ¬Šå¹³å‡è‚¡æ•¸_Q'] * 1000

# 1å¹´æœŸï¼ˆ252 äº¤æ˜“æ—¥ï¼‰ç§»å‹•å¹³å‡æŒ‡æ¨™
data__['1å¹´å¹³å‡ç¨…å¾Œæ·¨åˆ©æˆé•·ç‡'] = (
    data__.groupby('è‚¡ç¥¨ä»£ç¢¼')['ç¨…å¾Œæ·¨åˆ©æˆé•·ç‡_Q']
    .rolling(252).mean().reset_index(level=0, drop=True)
)
data__['1å¹´å¹³å‡ç¾é‡‘è‚¡åˆ©ç‡'] = (
    data__.groupby('è‚¡ç¥¨ä»£ç¢¼')['ç¾é‡‘è‚¡åˆ©ç‡']
    .rolling(252).mean().reset_index(level=0, drop=True)
)

# ç°¡æ˜“ Sharpeï¼ˆä»¥è¿‘ 252 æ—¥å ±é…¬ç‡å‡å€¼ / æ¨™æº–å·®ï¼‰
data__['sharpe_ratio'] = (
    data__.groupby('è‚¡ç¥¨ä»£ç¢¼')['å ±é…¬ç‡'].rolling(252).mean().reset_index(0, drop=True) /
    data__.groupby('è‚¡ç¥¨ä»£ç¢¼')['å ±é…¬ç‡'].rolling(252).std().reset_index(0, drop=True)
)
```
## åŒ¯å…¥å›æ¸¬è³‡æ–™
```python
from zipline.data.run_ingest import simple_ingest

pools = pool + ['IR0001']  # åŠ å…¥åŠ æ¬ŠæŒ‡æ•¸åšåŸºæº–

start_ingest = start.replace('-', '')
end_ingest   = end.replace('-', '')

print('é–‹å§‹åŒ¯å…¥å›æ¸¬è³‡æ–™')
simple_ingest(name='tquant', tickers=pools, start_date=start_ingest, end_date=end_ingest)
print('çµæŸåŒ¯å…¥å›æ¸¬è³‡æ–™')
```

## å›æ¸¬æ¶æ§‹

```python
from zipline.pipeline import Pipeline
from zipline.pipeline.factors import Returns
from zipline.pipeline.filters import SingleAsset
from zipline.api import (
    set_slippage, set_commission, set_benchmark,
    symbol, record, order_target_percent, pipeline_output, attach_pipeline
)
from zipline.finance import commission, slippage

def initialize(context):
    # äº¤æ˜“æˆæœ¬ï¼†æ»‘åƒ¹
    set_slippage(slippage.VolumeShareSlippage(volume_limit=1, price_impact=0.01))
    set_commission(commission.Custom_TW_Commission())

    # åŸºæº–æŒ‡æ•¸ï¼ˆåŠ æ¬Šï¼‰
    set_benchmark(symbol('IR0001'))

    # ç‹€æ…‹ç®¡ç†
    context.i = 0
    context.state = False
    context.order_tickers = []
    context.last_tickers = []

def compute_stock(date, data):
    """
    æ ¹æ“šæŒ‡å®šçš„æ—¥æœŸé€²è¡Œé¸è‚¡ï¼Œå›å‚³ç¬¦åˆæ¢ä»¶çš„è‚¡ç¥¨æ¸…å–®ï¼ˆæœ€å¤š 20 æª”ï¼‰ã€‚
    """
    # æå–æŒ‡å®šæ—¥æœŸçš„è‚¡ç¥¨è³‡è¨Š
    df = data[data['æ—¥æœŸ'] == pd.Timestamp(date)].reset_index(drop=True)

    # æ¢ä»¶ 1ï¼šè² å‚µæ¯”ç‡ â‰¤ ç”¢æ¥­å¹³å‡ï¼ˆæ­¤è™•æ¡ä½ æä¾›çš„ç‰ˆæœ¬ï¼‰
    set_1 = set(df[df['è² å‚µæ¯”ç‡_Q'] <= df.groupby('ä¸»ç”¢æ¥­åˆ¥_ä¸­æ–‡')['è² å‚µæ¯”ç‡_Q'].transform('mean')]['è‚¡ç¥¨ä»£ç¢¼'])

    # æ¢ä»¶ 2ï¼šæ¯è‚¡æ·¨ç¾é‡‘ > ç”¢æ¥­å¹³å‡
    df['ç”¢æ¥­å¹³å‡æ¯è‚¡æ·¨ç¾é‡‘'] = df.groupby('ä¸»ç”¢æ¥­åˆ¥_ä¸­æ–‡')['æ¯è‚¡æ·¨ç¾é‡‘'].transform('mean')
    set_2 = set(df[df['æ¯è‚¡æ·¨ç¾é‡‘'] > df['ç”¢æ¥­å¹³å‡æ¯è‚¡æ·¨ç¾é‡‘']]['è‚¡ç¥¨ä»£ç¢¼'])

    # æ¢ä»¶ 3ï¼šP/FCF < ç”¢æ¥­å¹³å‡
    df['è‚¡åƒ¹/æ¯è‚¡è‡ªç”±ç¾é‡‘æµ'] = df['æ”¶ç›¤åƒ¹'] / df['æ¯è‚¡è‡ªç”±ç¾é‡‘æµ']
    df['ç”¢æ¥­å¹³å‡è‚¡åƒ¹/æ¯è‚¡è‡ªç”±ç¾é‡‘æµ'] = df.groupby('ä¸»ç”¢æ¥­åˆ¥_ä¸­æ–‡')['è‚¡åƒ¹/æ¯è‚¡è‡ªç”±ç¾é‡‘æµ'].transform('mean')
    set_3 = set(df[df['è‚¡åƒ¹/æ¯è‚¡è‡ªç”±ç¾é‡‘æµ'] < df['ç”¢æ¥­å¹³å‡è‚¡åƒ¹/æ¯è‚¡è‡ªç”±ç¾é‡‘æµ']]['è‚¡ç¥¨ä»£ç¢¼'])

    # æ¢ä»¶ 4ï¼šå­˜è²¨æˆé•·ç‡ < ç‡Ÿæ”¶æˆé•·ç‡
    set_4 = set(df[df['å­˜è²¨æˆé•·ç‡'] < df['ç‡Ÿæ”¶æˆé•·ç‡_Q']]['è‚¡ç¥¨ä»£ç¢¼'])

    # æ¢ä»¶ 5ï¼š(1å¹´å¹³å‡ç›ˆé¤˜æˆé•·ç‡ + ç¾é‡‘è‚¡æ¯ç‡) / P/E â‰¥ 2
    df['æ¢ä»¶äº”'] = (df['1å¹´å¹³å‡ç¨…å¾Œæ·¨åˆ©æˆé•·ç‡'] + df['1å¹´å¹³å‡ç¾é‡‘è‚¡åˆ©ç‡']) / (df['æœ¬ç›Šæ¯”'])
    set_5 = set(df[df['æ¢ä»¶äº”'] >= 2]['è‚¡ç¥¨ä»£ç¢¼'])

    # äº¤é›†
    tickers = list(set_1 & set_2 & set_3 & set_4 & set_5)

    # ä¾ Sharpe æ’åºï¼Œå–å‰ 20 æª”
    filtered_df = df[df['è‚¡ç¥¨ä»£ç¢¼'].isin(tickers)].copy()
    filtered_df = filtered_df[filtered_df['sharpe_ratio'].notna()]
    sorted_df = filtered_df.sort_values(by='sharpe_ratio', ascending=False)
    top_20 = sorted_df['è‚¡ç¥¨ä»£ç¢¼'].tolist()[:20]
    return top_20

rebalance_period = 21  # æ¯ 21 äº¤æ˜“æ—¥ï¼ˆç´„æœˆæ›´ï¼‰

def handle_data_1(context, data, rebalance=rebalance_period):
    # é¿å…å‰è¦–ï¼šåœ¨æ“‡è‚¡çš„ä¸‹ä¸€äº¤æ˜“æ—¥æ‰ä¸‹å–®
    if context.state is True:
        print(f"ä¸‹å–®æ—¥æœŸï¼š{data.current_dt.date()}, æ“‡è‚¡è‚¡ç¥¨æ•¸é‡ï¼š{len(context.order_tickers)}")

        # ç æ‰å·²ä¸åœ¨åå–®ä¸­çš„æŒè‚¡
        for i in context.last_tickers:
            if i not in context.order_tickers:
                order_target_percent(symbol(i), 0)

        # ç­‰æ¬Šå»ºå€‰
        for i in context.order_tickers:
            order_target_percent(symbol(i), 1 / len(context.order_tickers))
            curr = data.current(symbol(i), 'price')
            record(price=curr, days=context.i)

        context.last_tickers = context.order_tickers
        context.state = False

    backtest_date = data.current_dt.date()

    # æœˆæœ«ï¼ˆæˆ–å›ºå®šé€±æœŸï¼‰æ“‡è‚¡
    if context.i % rebalance == 0:
        context.state = True
        context.order_tickers = compute_stock(date=backtest_date, data=data__)
        print(f"æœˆæœ«æ“‡è‚¡åå–®: {context.order_tickers}")

    context.i += 1
```

## ç¸¾æ•ˆåœ–è¡¨ï¼†åˆ†æ
```python
from pyfolio.utils import extract_rets_pos_txn_from_zipline
import pyfolio
import matplotlib.pyplot as plt
import matplotlib

# å–å¾—å›æ¸¬çµæœ
returns, positions, transactions = extract_rets_pos_txn_from_zipline(results)
benchmark_rets = results.benchmark_return

# æ™‚å€æ¨™æº–åŒ–
returns.index = returns.index.tz_localize(None).tz_localize('UTC')
positions.index = positions.index.tz_localize(None).tz_localize('UTC')
transactions.index = transactions.index.tz_localize(None).tz_localize('UTC')
benchmark_rets.index = benchmark_rets.index.tz_localize(None).tz_localize('UTC')

# å­—å‹ï¼ˆå¦‚éœ€é¡¯ç¤ºä¸­æ–‡ï¼‰
matplotlib.rcParams['font.family'] = 'SimHei'
matplotlib.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

# æ§“æ¡¿èˆ‡å®Œæ•´å ±è¡¨
pyfolio.plot_gross_leverage(returns, positions)
pyfolio.tears.create_full_tear_sheet(
    returns=returns,
    positions=positions,
    transactions=transactions,
    benchmark_rets=benchmark_rets
)
```
## ç¸¾æ•ˆåœ–è¡¨ï¼†åˆ†æ

| ç¸¾æ•ˆæŒ‡æ¨™ / ç­–ç•¥      | å¤§ç›¤ (Benchmark) | å½¼å¾—æ—å€æŠ•è³‡ç­–ç•¥ |
|----------------------|------------------|------------------|
| å¹´åŒ–å ±é…¬ç‡           | 13.598%          | 15.508%          |
| ç´¯ç©å ±é…¬ç‡           | 145.974%         | 176.705%         |
| å¹´åŒ–æ³¢å‹•ç‡           | 18.44%           | 21.49%           |
| å¤æ™®å€¼               | 0.78             | 0.78             |
| å¡ç‘ªæ¯”ç‡             | 0.48             | 0.55             |
| æœŸé–“æœ€å¤§å›æ’¤         | -28.553%         | -28.022%         |

ä¸ƒå¹´å…§ç´¯ç©å ±é…¬ç‡ ~ 176.71%ã€å¹´åŒ– ~ 15.51%ï¼Œæ•´é«”ç•¥å„ªæ–¼åŸºæº–ã€‚

å­˜åœ¨æ­£å‘ Alphaï¼Œä½†èˆ‡å¤§ç›¤ç›¸é—œæ€§åé«˜ï¼›å¹´åŒ–æ³¢å‹• ~ 21.49%ã€‚

æœ€å¤§å›æ’¤ç´„ -28.02%ï¼›å»ºè­°å¯åŠ å…¥ æ›éšªæ§ç®¡/é¢¨éšªæŒ‡æ¨™ï¼ˆå¦‚ OTC/TSE æ¯”ã€æ³¢å‹•ç›®æ¨™ã€å‹•èƒ½æ¿¾ç¶²ï¼‰ä»¥æå‡ç©©å®šåº¦ã€‚